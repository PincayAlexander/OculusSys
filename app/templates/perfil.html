{% extends "layout/base.html" %}

{% block title %}Perfil de Usuario{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">
{% endblock %}

{% block content %}
<div class="forms profile__forms">
  <div class="profile__header">
    <div class="svg-src" data-src="account"></div>
    <h2>Mi Perfil</h2>
  </div>

  <div class="profile__avatar">

    <div class="avatar-wrapper" style="position: relative; display: inline-block;">
      <img id="profileImg" src="{{ url_for('auth.ver_foto_usuario') }}" alt="Foto de perfil" style="width:150px; height:150px; border-radius:50%; object-fit:cover;">
      <!-- Mini cámara para subir imagen -->
      <label for="foto_perfil_input" class="camera-icon" style="position:absolute; bottom:5px; right:5px; cursor:pointer;">
        <div class="svg-src" data-src="captura"></div>
      </label>

    </div>


    <div class="profile__info">
      <p class="profile__username">{{ usuario.first_name }} {{ usuario.last_name }}</p>
      <p class="profile__email">{{ usuario.email }}</p>
    </div>
  </div>

  <form method="POST" action="{{ url_for('auth.actualizar_perfil') }}" id="profileForm" enctype="multipart/form-data">
    <input type="file" id="foto_perfil_input" name="foto_perfil" accept="image/*" style="display:none;">
    <!-- Nombres y Apellidos -->
    <div class="forms__group--double">
      <div class="forms__group halft">
        <input type="text" name="first_name" id="first_name" class="forms__input--text" placeholder=" "
          value="{{ usuario.first_name }}" required>
        <label for="first_name" class="forms__label">Nombres</label>
      </div>
      <div class="forms__group halft">
        <input type="text" name="last_name" id="last_name" class="forms__input--text" placeholder=" "
          value="{{ usuario.last_name }}" required>
        <label for="last_name" class="forms__label">Apellidos</label>
      </div>
    </div>

    <!-- Nombre de Usuario y Correo -->
    <div class="forms__group--double">
      <div class="forms__group halft">
        <input type="text" name="username" id="username" class="forms__input--text" placeholder=" "
          value="{{ usuario.username }}" required>
        <label for="username" class="forms__label">Nombre de usuario</label>
      </div>
      <div class="forms__group halft">
        <input type="email" name="email" id="email" class="forms__input--text" placeholder=" "
          value="{{ usuario.email }}" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
          title="Ingresa un correo electrónico válido.">
        <label for="email" class="forms__label">E-mail</label>
      </div>
    </div>

    <!-- Botón de envío -->
    <div class="forms__buttons">
      <button type="submit" class="btn btn__submit">
        <span>Guardar cambios</span>
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const fotoInput = document.getElementById('foto_perfil_input');
    const profileImg = document.getElementById('profileImg');

    // Mostrar la imagen seleccionada inmediatamente
    fotoInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                profileImg.src = ev.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
});
</script>
{% endblock %}